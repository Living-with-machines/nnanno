---

title: Creating training data


keywords: fastai
sidebar: home_sidebar

summary: "Labelling visual content in adverts"
description: "Labelling visual content in adverts"
nb_path: "nbs/examples/ads/01_sampling_and_labels.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/examples/ads/01_sampling_and_labels.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>\ # TODO aims for notebook, temporal</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nnanno.sample</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">nnanno.annotate</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">nnSampler</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll create a sample of ~1000 images. This will hopefully be a good balance between generating a big enough training dataset and not having to annotate too much. Since we're going to be annotating binary labels the cognitive load of annotating becomes much lower which should also help make a higher number of annotations relatively quick to do.</p>
<p>The time it takes to generate this sample will depend on your connection speed. If you have previously requested the same data the results will be cached making the request quicker.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">create_sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;ads&#39;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">year_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filepath</th>
      <th>pub_date</th>
      <th>page_seq_num</th>
      <th>edition_seq_num</th>
      <th>batch</th>
      <th>lccn</th>
      <th>box</th>
      <th>score</th>
      <th>ocr</th>
      <th>place_of_publication</th>
      <th>geographic_coverage</th>
      <th>name</th>
      <th>publisher</th>
      <th>url</th>
      <th>page_url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>iahi_bellsprout_ver01/data/sn86081965/00279528...</td>
      <td>1850-03-29</td>
      <td>97</td>
      <td>1</td>
      <td>iahi_bellsprout_ver01</td>
      <td>sn86081965</td>
      <td>[0.024251411534562894, 0.3835335029129611, 0.1...</td>
      <td>0.913842</td>
      <td>[IVt'w, Tailor, JVI., W7FOX,, bt, laving, had,...</td>
      <td>[Ottumwa] Iowa</td>
      <td>[Iowa--Wapello--Ottumwa]</td>
      <td>Des Moines courier.</td>
      <td>Jos. H.D. Street &amp; R.H. Warden</td>
      <td>https://news-navigator.labs.loc.gov/data/iahi_...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ncu_jefferson_ver02/data/sn84020750/0041566727...</td>
      <td>1850-06-15</td>
      <td>527</td>
      <td>1</td>
      <td>ncu_jefferson_ver02</td>
      <td>sn84020750</td>
      <td>[0.34810119576694826, 0.2741584396107822, 0.50...</td>
      <td>0.936948</td>
      <td>[WONDERS, OF, THE, AGE., NEW, STORE, AVO, Come...</td>
      <td>Fayetteville [N.C.]</td>
      <td>[North Carolina--Cumberland--Fayetteville]</td>
      <td>The North-Carolinian. [volume]</td>
      <td>H.L. Holmes</td>
      <td>https://news-navigator.labs.loc.gov/data/ncu_j...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>vtu_irasburg_ver01/data/sn83025667/00280777791...</td>
      <td>1850-06-11</td>
      <td>98</td>
      <td>1</td>
      <td>vtu_irasburg_ver01</td>
      <td>sn83025667</td>
      <td>[0.04051448987877887, 0.039025070075701954, 0....</td>
      <td>0.929399</td>
      <td>["HOHESTY, It'llE, BEST, POLICY.", fpilft, Srn...</td>
      <td>Middlebury, Vt.</td>
      <td>[Vermont--Addison--Middlebury]</td>
      <td>The Middlebury register. [volume]</td>
      <td>J.H. Barrett &amp; Cobb</td>
      <td>https://news-navigator.labs.loc.gov/data/vtu_i...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>msar_eiffel_ver02/data/sn87090127/0029587756A/...</td>
      <td>1850-09-28</td>
      <td>125</td>
      <td>1</td>
      <td>msar_eiffel_ver02</td>
      <td>sn87090127</td>
      <td>[0.6785962092050805, 0.3929028666983783, 0.832...</td>
      <td>0.915581</td>
      <td>[L., XV., COOK,, DEALERS, IN, MAHOGANY, &amp;, KOE...</td>
      <td>Oxford, Miss.</td>
      <td>[Mississippi--Lafayette--Oxford]</td>
      <td>The organizer.</td>
      <td>B.F. Dill &amp; Wm. Delay</td>
      <td>https://news-navigator.labs.loc.gov/data/msar_...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>vi_kernals_ver01/data/sn84024718/00414183736/1...</td>
      <td>1850-03-27</td>
      <td>53</td>
      <td>1</td>
      <td>vi_kernals_ver01</td>
      <td>sn84024718</td>
      <td>[0.4941717015081273, 0.17639242121013235, 0.64...</td>
      <td>0.916670</td>
      <td>[Agents., 0C&gt;-, W., S., Febâ€™tig,, Esq.,, of, H...</td>
      <td>Staunton, Va.</td>
      <td>[Virginia--Staunton]</td>
      <td>Staunton spectator. [volume]</td>
      <td>L. Waddell, J.A. Waddell</td>
      <td>https://news-navigator.labs.loc.gov/data/vi_ke...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_label_studio_json</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">&#39;data/ad_tasks.json&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="nt">&lt;View&gt;</span>
  <span class="nt">&lt;Image</span> <span class="na">name=</span><span class="s">&quot;image&quot;</span> <span class="na">value=</span><span class="s">&quot;$image&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Choices</span> <span class="na">name=</span><span class="s">&quot;choice&quot;</span> <span class="na">toName=</span><span class="s">&quot;image&quot;</span> <span class="na">showInLine=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Choice</span> <span class="na">value=</span><span class="s">&quot;visual&quot;</span> <span class="na">background=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Choice</span> <span class="na">value=</span><span class="s">&quot;text_only&quot;</span> <span class="na">background=</span><span class="s">&quot;green&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/Choices&gt;</span>
<span class="nt">&lt;/View&gt;</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="load">load<a class="anchor-link" href="#load"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">load_annotations_csv</span><span class="p">(</span><span class="s1">&#39;data/results.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>batch</th>
      <th>box</th>
      <th>edition_seq_num</th>
      <th>filepath</th>
      <th>geographic_coverage</th>
      <th>image</th>
      <th>lccn</th>
      <th>name</th>
      <th>ocr</th>
      <th>page_seq_num</th>
      <th>page_url</th>
      <th>place_of_publication</th>
      <th>pub_date</th>
      <th>publisher</th>
      <th>score</th>
      <th>url</th>
      <th>id</th>
      <th>choice</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>okhi_ham_ver01</td>
      <td>[0.5706211635044642, 0.7756719712174839, 0.705...</td>
      <td>1</td>
      <td>okhi_ham_ver01/data/sn86090528/00295864655/192...</td>
      <td>['Oklahoma--Grady--Chickasha']</td>
      <td>https://chroniclingamerica.loc.gov/iiif/2/okhi...</td>
      <td>sn86090528</td>
      <td>The Chickasha daily express.</td>
      <td>['EiLIMJNATE', 'QIESTION', '6', 'o;m', 'rest',...</td>
      <td>762</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
      <td>Chickasha, Indian Territory [Okla.]</td>
      <td>1920-08-18</td>
      <td>A.M. Dawson</td>
      <td>0.952871</td>
      <td>https://news-navigator.labs.loc.gov/data/okhi_...</td>
      <td>729</td>
      <td>text_only</td>
      <td>text_only</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pub_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1890    99
1910    99
1930    99
1850    99
1870    99
1940    99
1900    99
1950    99
1920    98
1860    98
1880    97
Name: pub_date, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="download-annotations">download annotations<a class="anchor-link" href="#download-annotations"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampler</span><span class="o">.</span><span class="n">download_sample</span><span class="p">(</span><span class="s1">&#39;data/images&#39;</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

