---

title: Sample


keywords: fastai
sidebar: home_sidebar

summary: "Create samples from <a href='https://news-navigator.labs.loc.gov/'>Newspaper Navigator</a> "
description: "Create samples from <a href='https://news-navigator.labs.loc.gov/'>Newspaper Navigator</a> "
nb_path: "nbs/01_sample.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_sample.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Newspaper-Navigator-JSON-files">Newspaper Navigator JSON files<a class="anchor-link" href="#Newspaper-Navigator-JSON-files"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_json_url" class="doc_header"><code>get_json_url</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_json_url</code>(<strong><code>year</code></strong>:<code>Union</code>[<code>str</code>, <code>int</code>], <strong><code>kind</code></strong>:<code>str</code>=<em><code>'photos'</code></em>)</p>
</blockquote>
<p>Returns url for the json data from news-navigator for given <code>year</code> and <code>kind</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">get_json_url</span><span class="p">(</span><span class="mi">1860</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;https://news-navigator.labs.loc.gov/prepackaged/1860_photos.json&#39;</span> 
<span class="k">assert</span> <span class="n">get_json_url</span><span class="p">(</span><span class="mi">1950</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;https://news-navigator.labs.loc.gov/prepackaged/1950_photos.json&#39;</span> 
<span class="k">assert</span> <span class="n">get_json_url</span><span class="p">(</span><span class="mi">1950</span><span class="p">,</span><span class="s1">&#39;ads&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;https://news-navigator.labs.loc.gov/prepackaged/1950_ads.json&#39;</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_json" class="doc_header"><code>load_json</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L59" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_json</code>(<strong><code>url</code></strong>)</p>
</blockquote>
<p>Returns json loaded from <code>url</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can also test that this returns what we think inside the notebook. These tests are often hidden in the documentation but inside the notebook there will often be a cell below a function which includes some tests for the function which has just been defined.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_json</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="s1">&#39;https://news-navigator.labs.loc.gov/prepackaged/1950_photos.json&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">test_json</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">test_json</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Working-with-big-JSON">Working with big JSON<a class="anchor-link" href="#Working-with-big-JSON"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This works well for a smallish file but if we try this with the <a href="https://news-navigator.labs.loc.gov/prepackaged/1910_ads.json">1905_ads.json</a> file which is ~3.3GB we will likely run out of memory. For example running</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://news-navigator.labs.loc.gov/prepackaged/1910_ads.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
<p>on a Google Colab instance with 25GB of RAM causes a crash.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Streaming-JSON">Streaming JSON<a class="anchor-link" href="#Streaming-JSON"> </a></h2><p>One way to get around this would be to throw more RAM at the problem. However since we only want to sample the JSON and don't need to work with the whole dataset this seems a bit wasteful. Instead we'll <code>ijson</code> a Python library for streaming JSON.</p>
<p>We can see how this works for a url from newspaper navigator. If we create a request via Requests using <code>stream=True</code> to return a streaming version of the response.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_json_url</span><span class="p">(</span><span class="mi">1850</span><span class="p">,</span> <span class="s1">&#39;ads&#39;</span><span class="p">),</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can pass this response to <code>ijson</code>. In this case we just parse an item at a time. If the JSON is really big this might already be too much. <code>ijson</code> allows for much more granular parsing of JSON but for what we need, parsing by item is fine. We can see what the return of this looks like</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">objects</span> <span class="o">=</span> <span class="n">ijson</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">)</span>
<span class="n">objects</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;_yajl2.items at 0x7fa7204ce030&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We get back something from <code>_yajl2</code> this is the underlying parser ijson is using. See <code>ijson</code> docs for more on available parsers.</p>
<p>We can call next on this object to start iterating over it, one item at a time. If we look at the keys of the first response you'll see that this is one entry from the original JSON data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">first</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span>
<span class="n">first</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;filepath&#39;, &#39;pub_date&#39;, &#39;page_seq_num&#39;, &#39;edition_seq_num&#39;, &#39;batch&#39;, &#39;lccn&#39;, &#39;box&#39;, &#39;score&#39;, &#39;ocr&#39;, &#39;place_of_publication&#39;, &#39;geographic_coverage&#39;, &#39;name&#39;, &#39;publisher&#39;, &#39;url&#39;, &#39;page_url&#39;])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Counting-the-size-of-the-data">Counting the size of the data<a class="anchor-link" href="#Counting-the-size-of-the-data"> </a></h3><p>If we want to sample from newspaper navigator it is important to be able to know the size of the total population for a given year and kind of image i.e. 10000 photos for 1950.</p>
<p>Normally in Python we would use <code>len</code> to count the length of a python object</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;three&#39;</span><span class="p">}</span>
<span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>3</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If we try and do this with our <code>objects</code> we get an error <code>TypeError: object of type '_yajl2.items' has no len()</code>. This is because the point if of ijson is to avoid loading json into memory so we don't know how long the total data will be.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can get around this by using the <a href="https://toolz.readthedocs.io/en/">toolz</a> libraries <a href="https://toolz.readthedocs.io/en/latest/api.html#toolz.itertoolz.count">itertoolz.count</a> method. This is similar to <code>len</code> except that it can work on lazy sequences i.e. something which has a <code>next</code> attribute. This ends up being quite slow because we still need to go through all of the data which means that although we can avoid loading the data into memory we do still need to stream it all in order to get the length. Most of the time this won't be necessary anyway but in case we end up calling this function multiple times we cache the results to make sure we don't calculate the length of the same data multiple times.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="count_json_iter" class="doc_header"><code>count_json_iter</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L66" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>count_json_iter</code>(<strong><code>url</code></strong>:<code>str</code>, <strong><code>session</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Returns count of objects in url json file using an iterator to avoid loading json into memory</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nnanno/sample.html#count_json_iter"><code>count_json_iter</code></a> counts the length of a json file loaded via <code>url</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count_json_iter</span><span class="p">(</span><span class="s1">&#39;https://news-navigator.labs.loc.gov/prepackaged/1850_photos.json&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>22</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://news-navigator.labs.loc.gov/prepackaged/1850_photos.json&#39;</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">count_json_iter</span><span class="p">(</span><span class="n">url</span><span class="p">))</span> <span class="o">==</span> <span class="nb">int</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">))</span> <span class="o">==</span> <span class="n">count_json_iter</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_year_size" class="doc_header"><code>get_year_size</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L81" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_year_size</code>(<strong><code>year</code></strong>:<code>Union</code>[<code>int</code>, <code>str</code>], <strong><code>kind</code></strong>:<code>str</code>)</p>
</blockquote>
<p>returns size of a json dataset for a given year and kind
results are cached</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>year : Union[int,str]
    year from newspaper navigator
kind : str
    {'ads', 'photos', 'maps', 'illustrations', 'comics', 'cartoons', 'headlines'}</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>size :dict
    returns a dict with year as a key and size as value</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_year_size</span><span class="p">(</span><span class="mi">1850</span><span class="p">,</span> <span class="s1">&#39;photos&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;1850&#39;: 22}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_year_sizes" class="doc_header"><code>get_year_sizes</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L105" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_year_sizes</code>(<strong><code>kind</code></strong>, <strong><code>start</code></strong>=<em><code>1850</code></em>, <strong><code>end</code></strong>=<em><code>1950</code></em>, <strong><code>step</code></strong>=<em><code>5</code></em>)</p>
</blockquote>
<p>Returns the sizes for json data files for <code>kind</code> between year <code>start</code> and <code>end</code>
with step size 'step'</p>
<p>Parameters:
kind (str): kind of image from news-navigator:
{'ads', 'photos', 'maps', 'illustrations', 'comics', 'cartoons', 'headlines'}</p>
<p>Returns:
Pandas.DataFrame: holding data from input json url</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Returns the year sizes for a given kind taking a step size <code>step</code>. For example to get the number of photos in the news-navigator dataset between 1850 and 1860 for every year:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">get_year_sizes</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span><span class="mi">1850</span><span class="p">,</span> <span class="mi">1855</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 146 ms, sys: 37.9 ms, total: 184 ms
Wall time: 1.2 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>photos_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1850</th>
      <td>22</td>
    </tr>
    <tr>
      <th>1851</th>
      <td>20</td>
    </tr>
    <tr>
      <th>1852</th>
      <td>22</td>
    </tr>
    <tr>
      <th>1853</th>
      <td>45</td>
    </tr>
    <tr>
      <th>1854</th>
      <td>221</td>
    </tr>
    <tr>
      <th>1855</th>
      <td>17</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">get_year_sizes</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span><span class="mi">1850</span><span class="p">,</span> <span class="mi">1860</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">11</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">get_year_sizes</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span><span class="mi">1850</span><span class="p">,</span><span class="mi">1860</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="mi">6</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_all_year_sizes" class="doc_header"><code>get_all_year_sizes</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L134" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_all_year_sizes</code>(<strong><code>start</code></strong>=<em><code>1850</code></em>, <strong><code>end</code></strong>=<em><code>1950</code></em>, <strong><code>step</code></strong>=<em><code>1</code></em>, <strong><code>save</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>Returns a dataframe with number of counts from year <code>start</code> to <code>end</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Creating-Samples">Creating Samples<a class="anchor-link" href="#Creating-Samples"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Streaming-sampling">Streaming sampling<a class="anchor-link" href="#Streaming-sampling"> </a></h3><p>Since we want a subset of the Newspaper Navigator datasets which we can either work with for <a href="!TODO add link">annotation</a> or for inference we want to create samples. Sampling in python can be complicated depending on the type of population you are working with and the properties your sample needs to have but usually we can do something fairly simple like. For example, if we want to sample from a selection of books we could do:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="n">books</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;War and Peace&#39;</span><span class="p">,</span> <span class="s1">&#39;Frankenstein&#39;</span><span class="p">,</span> <span class="s1">&#39;If They Come in the Morning&#39;</span><span class="p">]</span>
<span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;War and Peace&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, we run into a same problem as when trying to get the length of a json dataset which wouldn't fit into memory above. For example if we want to sample $k$ examples from one of our json files which we can't load into memory. To get around this we can use <a href="https://en.wikipedia.org/wiki/Reservoir_sampling">Reservoir_sampling</a>:</p>
<blockquote><p>Reservoir sampling is a family of randomized algorithms for choosing a simple random sample without replacement of k items from a population of unknown size n in a single pass over the items. The size of the population n is not known to the algorithm and is typically too large to fit all n items into main memory. The population is revealed to the algorithm over time, and the algorithm cannot look back at previous items.</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sample_stream" class="doc_header"><code>sample_stream</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L151" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sample_stream</code>(<strong><code>stream</code></strong>, <strong><code>k</code></strong>:<code>int</code>)</p>
</blockquote>
<p>Return a random sample of k elements drawn without replacement from stream.
Designed to be used when the elements of stream cannot easily fit into memory.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we sample whilst only loading a small numer of items into memory at one time. This does come at some cost, mainly speed. There are faster ways of sampling from a stream but this isn't the main bottle neck for sampling in this case. We can for example sample from a large range of numbers without memory issues.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_stream</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100000</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([62151, 45070, 43590, 71352, 61951])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can still sample from lists</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Karl Marx&#39;</span><span class="p">,</span> <span class="s1">&#39;Rosa Luxenburg&#39;</span><span class="p">,</span> <span class="s1">&#39;Raya Dunayevskaya&#39;</span><span class="p">,</span> <span class="s1">&#39;CLR James&#39;</span><span class="p">]</span>
<span class="n">sample_stream</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([&#39;Karl Marx&#39;, &#39;Raya Dunayevsk&#39;], dtype=&#39;&lt;U14&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_frac_size" class="doc_header"><code>calc_frac_size</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L164" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_frac_size</code>(<strong><code>url</code></strong>, <strong><code>frac</code></strong>, <strong><code>session</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>returns fraction size from a json stream</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_year_from_total" class="doc_header"><code>calc_year_from_total</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L170" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_year_from_total</code>(<strong><code>total</code></strong>, <strong><code>start</code></strong>, <strong><code>end</code></strong>, <strong><code>step</code></strong>)</p>
</blockquote>
<p>Calculate size of a year sample based on a total sample size</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calc_year_from_total</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1850</span><span class="p">,</span> <span class="mi">18950</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Reducing-memory-usage">Reducing memory usage<a class="anchor-link" href="#Reducing-memory-usage"> </a></h3><p>Since we are trying to be a bit careful with memory usage we will convert column <code>dtypes</code> to be smaller when possible.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="reduce_df_memory" class="doc_header"><code>reduce_df_memory</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L175" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>reduce_df_memory</code>(<strong><code>df</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sampling-Newspaper-navigator">Sampling Newspaper navigator<a class="anchor-link" href="#Sampling-Newspaper-navigator"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="nnSampler" class="doc_header"><code>class</code> <code>nnSampler</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L190" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>nnSampler</code>()</p>
</blockquote>
<p>Sampler for creating samples from Newspaper Navigator data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sample_year" class="doc_header"><code>sample_year</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L198" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sample_year</code>(<strong><code>kind</code></strong>:<code>str</code>, <strong><code>sample_size</code></strong>:<code>Union</code>[<code>int</code>, <code>float</code>], <strong><code>year</code></strong>:<code>int</code>)</p>
</blockquote>
<p>samples <code>sample_size</code> for <code>year</code> and <code>kind</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_year</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1850</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_year</span><span class="p">(</span><span class="s1">&#39;maps&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1850</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1"># test we always have a sample size of at least one </span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="None" class="doc_header"><code>None</code><a href="" class="source_link" style="float:right">[source]</a></h4>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nnSampler.create_sample" class="doc_header"><code>nnSampler.create_sample</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L221" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nnSampler.create_sample</code>(<strong><code>sample_size</code></strong>:<code>Union</code>[<code>int</code>, <code>float</code>], <strong><code>kind</code></strong>:<code>str</code>=<em><code>'photos'</code></em>, <strong><code>start_year</code></strong>:<code>int</code>=<em><code>1850</code></em>, <strong><code>end_year</code></strong>:<code>int</code>=<em><code>1950</code></em>, <strong><code>step</code></strong>:<code>int</code>=<em><code>5</code></em>, <strong><code>year_sample</code></strong>=<em><code>True</code></em>, <strong><code>save</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>reduce_memory</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Creates a sample of Newspaper Navigator data for a given set of years and a kind</p>
<p>Parameters:
sample_size: int, float
    <code>sample size</code> can either be a fixed number or a fraction of the total dataset size
kind (str): kind of image from news-navigator:
{'ads', 'photos', 'maps', 'illustrations', 'comics', 'cartoons', 'headlines'}</p>
<p>Returns:
Pandas.DataFrame: holding data from input json url</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nnanno/sample.html#create_sample"><code>create_sample</code></a> returns a dataframe which samples from Newspaper Navigator. <code>year_sample</code> controls whether you want <code>sample_size</code> to be for each year or for you entire sample. Selecting <code>year_sample</code> false will return a sample of a size close to what you define in <code>sample_size</code>. This is useful for example if you plan to annotate your sample with some new labels.</p>
<p>For any years where sample size is larger than the sample available you just get everything for that year.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampler</span><span class="o">=</span> <span class="n">nnSampler</span><span class="p">()</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">create_sample</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">end_year</span><span class="o">=</span><span class="mi">1852</span><span class="p">,</span> <span class="n">year_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filepath</th>
      <th>pub_date</th>
      <th>page_seq_num</th>
      <th>edition_seq_num</th>
      <th>batch</th>
      <th>lccn</th>
      <th>box</th>
      <th>score</th>
      <th>ocr</th>
      <th>place_of_publication</th>
      <th>geographic_coverage</th>
      <th>name</th>
      <th>publisher</th>
      <th>url</th>
      <th>page_url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>msar_icydrop_ver05/data/sn86074079/00295878502...</td>
      <td>1850-12-05</td>
      <td>1149</td>
      <td>1</td>
      <td>msar_icydrop_ver05</td>
      <td>sn86074079</td>
      <td>[0.4527419749698691, 0.07917078993055555, 0.75...</td>
      <td>0.951330</td>
      <td>[Wednesday, Dec., Uth, one, day, only., -, i, ...</td>
      <td>Canton, Miss.</td>
      <td>[Mississippi--Madison--Canton]</td>
      <td>The Madisonian.</td>
      <td>R.D. Price</td>
      <td>https://news-navigator.labs.loc.gov/data/msar_...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>in_indianapolisolympians_ver02/data/sn86058217...</td>
      <td>1850-04-03</td>
      <td>470</td>
      <td>1</td>
      <td>in_indianapolisolympians_ver02</td>
      <td>sn86058217</td>
      <td>[0.19613312344418035, 0.41648075810185187, 0.3...</td>
      <td>0.943215</td>
      <td>[,, j, ii, i:, 1., 1, a, it, A, I, II, V, ...]</td>
      <td>Richmond, IA [i.e. Ind.]</td>
      <td>[Indiana--Wayne--Richmond]</td>
      <td>Richmond palladium. [volume]</td>
      <td>D.P. Holloway &amp; B.W. Davis</td>
      <td>https://news-navigator.labs.loc.gov/data/in_in...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ohi_ingstad_ver01/data/sn85026051/00296027029/...</td>
      <td>1850-12-07</td>
      <td>115</td>
      <td>1</td>
      <td>ohi_ingstad_ver01</td>
      <td>sn85026051</td>
      <td>[0.30707743987524494, 0.6473851770787806, 0.44...</td>
      <td>0.984739</td>
      <td>[COME, IN,, WE, CALL, YOU!]</td>
      <td>Fremont, Sandusky County, Ohio</td>
      <td>[Ohio--Sandusky--Fremont]</td>
      <td>Fremont weekly freeman. [volume]</td>
      <td>J.S. Fouke</td>
      <td>https://news-navigator.labs.loc.gov/data/ohi_i...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ohi_edgar_ver01/data/sn85038121/00280775502/18...</td>
      <td>1852-06-24</td>
      <td>443</td>
      <td>1</td>
      <td>ohi_edgar_ver01</td>
      <td>sn85038121</td>
      <td>[0.5482568719219458, 0.05572789142773935, 0.80...</td>
      <td>0.966192</td>
      <td>[;, 'Y, '., ", i, ', -, 7, i, ', f, 1,, ft, ',...</td>
      <td>Gallipolis, Ohio</td>
      <td>[Ohio--Gallia--Gallipolis]</td>
      <td>Gallipolis journal. [volume]</td>
      <td>Alexander Vance</td>
      <td>https://news-navigator.labs.loc.gov/data/ohi_e...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>msar_cloudchaser_ver01/data/sn87065038/0029587...</td>
      <td>1852-10-07</td>
      <td>262</td>
      <td>1</td>
      <td>msar_cloudchaser_ver01</td>
      <td>sn87065038</td>
      <td>[0.4655820986278216, 0.5739247633736971, 0.601...</td>
      <td>0.968907</td>
      <td>[i, "ntnTf-fhr-i, -irrr-T-, r, ., -, J, I]</td>
      <td>Columbus, Miss.</td>
      <td>[Mississippi--Lowndes--Columbus]</td>
      <td>The primitive Republican.</td>
      <td>F.G. Baldwin</td>
      <td>https://news-navigator.labs.loc.gov/data/msar_...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>txdn_eastland_ver01/data/sn83025730/0027955983...</td>
      <td>1852-07-10</td>
      <td>611</td>
      <td>1</td>
      <td>txdn_eastland_ver01</td>
      <td>sn83025730</td>
      <td>[0.6132026808043348, 0.2620943737307529, 0.975...</td>
      <td>0.982666</td>
      <td>[1, i, ||, «, -, ', #, •«, ft,, %, &gt;*&lt;», I, &lt;,...</td>
      <td>Marshall, Tex.</td>
      <td>[Texas--Harrison--Marshall]</td>
      <td>The Texas Republican. [volume]</td>
      <td>F.J. Patillo</td>
      <td>https://news-navigator.labs.loc.gov/data/txdn_...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Downloading-sample-images">Downloading sample images<a class="anchor-link" href="#Downloading-sample-images"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="None" class="doc_header"><code>None</code><a href="" class="source_link" style="float:right">[source]</a></h4>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nnSampler.download_sample" class="doc_header"><code>nnSampler.download_sample</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/sample.py#L273" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nnSampler.download_sample</code>(<strong><code>out_dir</code></strong>:<code>str</code>, <strong><code>json_name</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>df</code></strong>:<code>Optional</code>[<code>DataFrame</code>]=<em><code>None</code></em>, <strong><code>original</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>pct</code></strong>:<code>Optional</code>[<code>int</code>]=<em><code>None</code></em>, <strong><code>size</code></strong>:<code>Optional</code>[<code>tuple</code>]=<em><code>None</code></em>, <strong><code>preserve_asp_ratio</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>Download images associated with a sample
The majority of paramters relate to the options available in a IIIF image request
see <code>https://iiif.io/api/image/3.0/#4-image-requests</code> for further information</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>out_dir
    The save directory for the images
json_name</p>
<p>df
    optional DataFrame containing a sample
original
    if <code>True</code> will download orginal size images via IIIF
pct
    optional value which scales the size of images requested by <code>pct</code>
size
    a tuple representing <code>width</code> by <code>height</code>, will be passed to IIIF request
preserve_asp_ratio
    whether to ask the IIIF request to preserve aspect ratio of image or not</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>None</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nnanno/sample.html#download_sample"><code>download_sample</code></a> is used to download images from a <a href="/nnanno/sample.html"><code>sample</code></a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">nnSampler</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampler</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>nnSampler</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampler</span><span class="o">.</span><span class="n">population</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ads_count</th>
      <th>photos_count</th>
      <th>maps_count</th>
      <th>illustrations_count</th>
      <th>comics_count</th>
      <th>cartoons_count</th>
      <th>headlines_count</th>
      <th>total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1850</th>
      <td>8841</td>
      <td>22</td>
      <td>5</td>
      <td>671</td>
      <td>9</td>
      <td>0</td>
      <td>11243</td>
      <td>20791</td>
    </tr>
    <tr>
      <th>1851</th>
      <td>10065</td>
      <td>20</td>
      <td>6</td>
      <td>457</td>
      <td>7</td>
      <td>0</td>
      <td>12262</td>
      <td>22817</td>
    </tr>
    <tr>
      <th>1852</th>
      <td>8764</td>
      <td>22</td>
      <td>10</td>
      <td>671</td>
      <td>10</td>
      <td>8</td>
      <td>13524</td>
      <td>23009</td>
    </tr>
    <tr>
      <th>1853</th>
      <td>11517</td>
      <td>45</td>
      <td>5</td>
      <td>1106</td>
      <td>88</td>
      <td>1</td>
      <td>13224</td>
      <td>25986</td>
    </tr>
    <tr>
      <th>1854</th>
      <td>15050</td>
      <td>221</td>
      <td>15</td>
      <td>732</td>
      <td>11</td>
      <td>3</td>
      <td>15282</td>
      <td>31314</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1946</th>
      <td>185139</td>
      <td>5945</td>
      <td>1857</td>
      <td>1053</td>
      <td>3280</td>
      <td>861</td>
      <td>68275</td>
      <td>266410</td>
    </tr>
    <tr>
      <th>1947</th>
      <td>181223</td>
      <td>4188</td>
      <td>1750</td>
      <td>1115</td>
      <td>3630</td>
      <td>797</td>
      <td>57018</td>
      <td>249721</td>
    </tr>
    <tr>
      <th>1948</th>
      <td>152987</td>
      <td>4282</td>
      <td>1359</td>
      <td>1154</td>
      <td>3031</td>
      <td>624</td>
      <td>43432</td>
      <td>206869</td>
    </tr>
    <tr>
      <th>1949</th>
      <td>154510</td>
      <td>6015</td>
      <td>1888</td>
      <td>1280</td>
      <td>3356</td>
      <td>634</td>
      <td>42904</td>
      <td>210587</td>
    </tr>
    <tr>
      <th>1950</th>
      <td>154961</td>
      <td>5630</td>
      <td>1952</td>
      <td>1223</td>
      <td>3893</td>
      <td>704</td>
      <td>37854</td>
      <td>206217</td>
    </tr>
  </tbody>
</table>
<p>101 rows × 8 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">create_sample</span><span class="p">(</span><span class="n">sample_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1850</span><span class="p">,</span><span class="n">end_year</span><span class="o">=</span><span class="mi">1855</span><span class="p">,</span><span class="n">reduce_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filepath</th>
      <th>pub_date</th>
      <th>page_seq_num</th>
      <th>edition_seq_num</th>
      <th>batch</th>
      <th>lccn</th>
      <th>box</th>
      <th>score</th>
      <th>ocr</th>
      <th>place_of_publication</th>
      <th>geographic_coverage</th>
      <th>name</th>
      <th>publisher</th>
      <th>url</th>
      <th>page_url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ohi_ingstad_ver01/data/sn85026051/00296027029/...</td>
      <td>1850-07-27</td>
      <td>37</td>
      <td>1</td>
      <td>ohi_ingstad_ver01</td>
      <td>sn85026051</td>
      <td>[0.29913574490319106, 0.622813938380955, 0.430...</td>
      <td>0.980025</td>
      <td>[ht, I, ', Wll., ., III, tl, T, ., "', "', ", ...</td>
      <td>Fremont, Sandusky County, Ohio</td>
      <td>[Ohio--Sandusky--Fremont]</td>
      <td>Fremont weekly freeman. [volume]</td>
      <td>J.S. Fouke</td>
      <td>https://news-navigator.labs.loc.gov/data/ohi_i...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ohi_ingstad_ver01/data/sn85026051/00296027029/...</td>
      <td>1850-07-20</td>
      <td>33</td>
      <td>1</td>
      <td>ohi_ingstad_ver01</td>
      <td>sn85026051</td>
      <td>[0.3009427797781111, 0.6294158908847332, 0.433...</td>
      <td>0.929614</td>
      <td>[L, -, COME, IN,, WE, CALL, YOU, !, .v';:]</td>
      <td>Fremont, Sandusky County, Ohio</td>
      <td>[Ohio--Sandusky--Fremont]</td>
      <td>Fremont weekly freeman. [volume]</td>
      <td>J.S. Fouke</td>
      <td>https://news-navigator.labs.loc.gov/data/ohi_i...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ncu_hawk_ver02/data/sn84026472/00416156360/185...</td>
      <td>1850-05-22</td>
      <td>289</td>
      <td>1</td>
      <td>ncu_hawk_ver02</td>
      <td>sn84026472</td>
      <td>[0.6732673909317263, 0.042179068056539225, 0.8...</td>
      <td>0.914908</td>
      <td>[]</td>
      <td>Hillsborough, N.C.</td>
      <td>[North Carolina--Orange--Hillsboro]</td>
      <td>The Hillsborough recorder. [volume]</td>
      <td>Dennis Heartt</td>
      <td>https://news-navigator.labs.loc.gov/data/ncu_h...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>msar_icydrop_ver05/data/sn86074079/00295878502...</td>
      <td>1850-12-05</td>
      <td>1149</td>
      <td>1</td>
      <td>msar_icydrop_ver05</td>
      <td>sn86074079</td>
      <td>[0.4527419749698691, 0.07917078993055555, 0.75...</td>
      <td>0.951330</td>
      <td>[Wednesday, Dec., Uth, one, day, only., -, i, ...</td>
      <td>Canton, Miss.</td>
      <td>[Mississippi--Madison--Canton]</td>
      <td>The Madisonian.</td>
      <td>R.D. Price</td>
      <td>https://news-navigator.labs.loc.gov/data/msar_...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>vtu_londonderry_ver01/data/sn84023252/00200296...</td>
      <td>1850-05-11</td>
      <td>283</td>
      <td>1</td>
      <td>vtu_londonderry_ver01</td>
      <td>sn84023252</td>
      <td>[0.5275910554108796, 0.16344128086556137, 0.68...</td>
      <td>0.915448</td>
      <td>[Old, Dr., Jnaob, TownHond,, 'Jlu, Utigiml, l)...</td>
      <td>St. Johnsbury, Vt.</td>
      <td>[Vermont--Caledonia--Saint Johnsbury]</td>
      <td>The Caledonian. [volume]</td>
      <td>A.G. Chadwick</td>
      <td>https://news-navigator.labs.loc.gov/data/vtu_l...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Downloading-a-sample">Downloading a sample<a class="anchor-link" href="#Downloading-a-sample"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampler</span><span class="o">.</span><span class="n">create_sample</span><span class="p">(</span><span class="n">sample_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;ads&#39;</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1850</span><span class="p">,</span><span class="n">end_year</span><span class="o">=</span><span class="mi">1850</span><span class="p">,</span><span class="n">reduce_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">download_sample</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_core.ipynb.
Converted 01_sample.ipynb.
Converted 02_annotate.ipynb.
Converted 03_inference.ipynb.
Converted index.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

