---

title: Annotate


keywords: fastai
sidebar: home_sidebar

summary: "Functionality to support creating and process annotation for samples of Newspaper Navigator data using Label Studio."
description: "Functionality to support creating and process annotation for samples of Newspaper Navigator data using Label Studio."
nb_path: "nbs/02_annotate.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_annotate.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Setup-annotation-task">Setup annotation task<a class="anchor-link" href="#Setup-annotation-task"> </a></h1><p>The bulk of annotation work is outsourced to labelstudio, label studio is a flexible annotations system which supports annotations for a range of types of data including images and text. This module does a few steps to help process annotations produced through label studio.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span>label-studio init advert_annotations --template<span class="o">=</span>image_classification --input-path<span class="o">=</span>images --input-format<span class="o">=</span>image-dir --allow-serving-local-files
</pre></div>
<div class="highlight"><pre><span></span>label-studio start ./advert_annotations
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Process-annotations">Process annotations<a class="anchor-link" href="#Process-annotations"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_df" class="doc_header"><code>load_df</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/annotate.py#L16" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_df</code>(<strong><code>json_file</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_completions" class="doc_header"><code>load_completions</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/annotate.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_completions</code>(<strong><code>path</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">load_completions</span><span class="p">(</span><span class="s1">&#39;../ph/ads/ad_annotations/&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>created_at</th>
      <th>id</th>
      <th>lead_time</th>
      <th>result</th>
      <th>data</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1602236711</td>
      <td>379001</td>
      <td>1.248</td>
      <td>[text-only]</td>
      <td>{'image': 'http://localhost:8081/data/upload/9...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">load_completions</span><span class="p">(</span><span class="s1">&#39;../ph/photos/multi_label/&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>created_at</th>
      <th>id</th>
      <th>lead_time</th>
      <th>result</th>
      <th>data</th>
      <th>skipped</th>
      <th>was_cancelled</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1596460221</td>
      <td>3721001</td>
      <td>8.94</td>
      <td>[human, landscape]</td>
      <td>{'image': '/data/vi_yes_ver01_data_sn84025841_...</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="anno_sample_merge" class="doc_header"><code>anno_sample_merge</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/annotate.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>anno_sample_merge</code>(<strong><code>sample_df</code></strong>:<code>DataFrame</code>, <strong><code>annotation_df</code></strong>:<code>DataFrame</code>)</p>
</blockquote>
<p>anno_sample_merge merges a DataFrame containing a sample
from Newspaper Navigator and a DataFrame containing annotations</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>sample_df : pd.DataFrame
    A Pandas DataFrame which holds a sample from Newspaper Navigator Generated by <code>sample.nnSample()</code>
annotation_df : pd.DataFrame
    A pandas DataFrame containing annotations loaded via the <code>annotate.nnAnnotations</code> class</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>pd.DataFrame
    A new DataFrame which merges the two input DataFrames</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../ph/ads/sample.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="nnAnnotations" class="doc_header"><code>class</code> <code>nnAnnotations</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/annotate.py#L76" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>nnAnnotations</code>(<strong><code>df</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nnAnnotations.from_completions" class="doc_header"><code>nnAnnotations.from_completions</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/annotate.py#L86" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nnAnnotations.from_completions</code>(<strong><code>path</code></strong>, <strong><code>kind</code></strong>, <strong><code>drop_dupes</code></strong>=<em><code>True</code></em>, <strong><code>sample_df</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">annotations</span> <span class="o">=</span> <span class="n">nnAnnotations</span><span class="o">.</span><span class="n">from_completions</span><span class="p">(</span><span class="s1">&#39;../ph/ads/ad_annotations/&#39;</span><span class="p">,</span> <span class="s1">&#39;classification&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">annotations</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>nnAnnotations #annotations:549</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">annotations</span><span class="o">.</span><span class="n">labels</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([&#39;text-only&#39;, &#39;illustrations&#39;], dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">annotations</span><span class="o">.</span><span class="n">label_counts</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>text-only        376
illustrations    173
Name: result, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nnAnnotations.merge_sample" class="doc_header"><code>nnAnnotations.merge_sample</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/annotate.py#L106" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nnAnnotations.merge_sample</code>(<strong><code>sample_df</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">annotations</span><span class="o">.</span><span class="n">merge_sample</span><span class="p">(</span><span class="n">sample_df</span><span class="p">)</span>
<span class="n">annotations</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filepath</th>
      <th>pub_date</th>
      <th>page_seq_num</th>
      <th>edition_seq_num</th>
      <th>batch</th>
      <th>lccn</th>
      <th>box</th>
      <th>score</th>
      <th>ocr</th>
      <th>place_of_publication</th>
      <th>geographic_coverage</th>
      <th>name</th>
      <th>publisher</th>
      <th>url</th>
      <th>page_url</th>
      <th>created_at</th>
      <th>id</th>
      <th>lead_time</th>
      <th>result</th>
      <th>data</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>iahi_gastly_ver01/data/sn82015737/00279529091/...</td>
      <td>1860-03-09</td>
      <td>447</td>
      <td>1</td>
      <td>iahi_gastly_ver01</td>
      <td>sn82015737</td>
      <td>[Decimal('0.30762831315880534'), Decimal('0.04...</td>
      <td>0.950152</td>
      <td>['JTO', 'TMCE', 'An', 't%E', '3eott', 'County'...</td>
      <td>Davenport, Iowa</td>
      <td>['Iowa--Scott--Davenport']</td>
      <td>Daily Democrat and news. [volume]</td>
      <td>Maguire, Richardson &amp; Co.</td>
      <td>https://news-navigator.labs.loc.gov/data/iahi_...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
      <td>1602237486</td>
      <td>iahi_gastly_ver01/data/sn82015737/00279529091/...</td>
      <td>0.838</td>
      <td>text-only</td>
      <td>iahi_gastly_ver01_data_sn82015737_00279529091_...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ohi_cobweb_ver04/data/sn85026050/00280775848/1...</td>
      <td>1860-08-17</td>
      <td>359</td>
      <td>1</td>
      <td>ohi_cobweb_ver04</td>
      <td>sn85026050</td>
      <td>[Decimal('0.5799164973813336'), Decimal('0.730...</td>
      <td>0.985859</td>
      <td>['9', 'BI.', 'I', '.QJtf', 'A', 'never', 'fall...</td>
      <td>Fremont, Sandusky County [Ohio]</td>
      <td>['Ohio--Sandusky--Fremont']</td>
      <td>Fremont journal. [volume]</td>
      <td>I.W. Booth</td>
      <td>https://news-navigator.labs.loc.gov/data/ohi_c...</td>
      <td>https://chroniclingamerica.loc.gov/data/batche...</td>
      <td>1602236992</td>
      <td>ohi_cobweb_ver04/data/sn85026050/00280775848/1...</td>
      <td>7.593</td>
      <td>illustrations</td>
      <td>ohi_cobweb_ver04_data_sn85026050_00280775848_1...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nnAnnotations.export_merged" class="doc_header"><code>nnAnnotations.export_merged</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/annotate.py#L109" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nnAnnotations.export_merged</code>(<strong><code>out_fn</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">annotations</span><span class="o">.</span><span class="n">export_merged</span><span class="p">(</span><span class="s1">&#39;testmerge.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nnAnnotations.from_completions" class="doc_header"><code>nnAnnotations.from_completions</code><a href="https://github.com/davanstrien/nnanno/tree/master/nnanno/annotate.py#L86" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nnAnnotations.from_completions</code>(<strong><code>path</code></strong>, <strong><code>kind</code></strong>, <strong><code>drop_dupes</code></strong>=<em><code>True</code></em>, <strong><code>sample_df</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">annotations</span> <span class="o">=</span> <span class="n">nnAnnotations</span><span class="o">.</span><span class="n">from_completions</span><span class="p">(</span><span class="s1">&#39;../ph/ads/ad_annotations/&#39;</span><span class="p">,</span> <span class="s1">&#39;classification&#39;</span><span class="p">)</span>
<span class="n">annotations</span><span class="o">.</span><span class="n">annotation_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>created_at</th>
      <th>id</th>
      <th>lead_time</th>
      <th>result</th>
      <th>data</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1602236711</td>
      <td>379001</td>
      <td>1.248</td>
      <td>text-only</td>
      <td>pst_fenske_ver02_data_sn84026497_00280776129_1...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1602237071</td>
      <td>396001</td>
      <td>0.870</td>
      <td>text-only</td>
      <td>scu_carlacox_ver01_data_sn84026965_00294551268...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_core.ipynb.
Converted 01_sample.ipynb.
Converted 02_annotate.ipynb.
Converted 03_inference.ipynb.
Converted index.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

